<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Problèmes textuels</title>

    <script src="https://unpkg.com/mathjs@6.5.0/dist/math.min.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML.js"></script>
    <script src="https://memoquiz.github.io/algebrite.bundle-for-browser.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">

</head>

<body>

    <h1>
        Résous le problème suivant
    </h1>
    <div>
        <h2 id="prob"></h2>
        <h2 id="table"></h2>
    </div>
    <h2 id=tableRep></h2>
    <h3 id="expr1"></h3>
    <h2>
        <br>Progression : <output id="reussi"></output> / <output id="total"></output>
        <br>Erreurs : <output id="erreurs"></output>

        <script>

            nouvelleQ = function () {

                rand = Math.floor(Math.random() * qarr.length);
                rand = 4;
                question = qlib[qarr[rand]];


                var variabtext = question.variables;
                var textrand = Math.floor(Math.random() * question.texte.length);
                var lenq = question.lenq(question.table);


                for (let z = 0; z < question.table.length; z++) {
                    var nrem = question.table[z];
                    var lentab = Number(question.table[z].length)
                    for (let y = 0; y < (lentab - lenq); y++) {
                        nrem.pop();
                    }
                    table[z] = nrem;
                }


                for (i of variabtext) {
                    var regex = RegExp(i[0], i[1]);
                    var remplarr = [];
                    try {
                        var varlen = question[i[0]][textrand].length
                        var varib = question[i[0]][textrand]
                    } catch {
                        var varib = question[i[0]](question.varmax[textrand], question.varmin[textrand])
                        var varlen = varib.length
                    }

                    for (let y = 0; y < varlen; y++) {
                        remplarr[y] = y;
                    }

                    for (let z = 0; z < question.table.length; z++) {
                        for (let w = 0; w < lenq; w++) {
                            if (question.table[z][w].match(regex)) {
                                var rand2 = Math.floor(Math.random() * remplarr.length);
                                var rempl = varib[remplarr[rand2]];
                                remplarr.splice(rand2, 1);
                                table[z][w] = question.table[z][w].replace(regex, rempl);
                            }
                        }
                    }
                }
                question.createTable(question, table, textrand)
                document.getElementById('prob').innerHTML = question.texte[textrand];
                update()
            }

            soum = function (repEleve) {
                var succes = question.testSoum(table, repEleve);
                var button = document.getElementById(repEleve)

                if (succes == true) {
                    if (nbEssais == 0) {
                        reussi++
                        //qarr.splice(rand, 1)
                    }
                    nbEssais = 0
                    if (reussi < total) {
                        nouvelleQ()
                        button.style.backgroundColor = "#4CAF50"
                        button.value = "Soumettre"

                    } else {
                        if (reussi / total > 0.8) {
                            document.getElementById('prob').innerHTML = 'Bravo!'
                        } else {
                            document.getElementById('prob').innerHTML = 'Tu as besoin de plus de pratique on dirait'
                        }
                        document.getElementById('tableRep').innerHTML = '<input type="button" class="button3" value="Recommancer?" id="Recommencer" style.backgroundColor = "#4CAF50" onclick="setTimeout(function(){recommencer()},100)">'
                        update()
                    }
                } else {
                    nbEssais = 1
                    button.style.backgroundColor = "red"
                    erreurs++
                    update()

                }

            }

            recommencer = function () {
                reussi = 0
                erreurs = 0
                resetquestion()
                nouvelleQ()
            }

            update = function () {
                document.getElementById('reussi').value = reussi
                document.getElementById('erreurs').value = erreurs
                document.getElementById('total').value = total
            }

            function arraysEqual(a, b) {
                if (a === b) return true;
                if (a == null || b == null) return false;
                if (a.length !== b.length) return false;

                // If you don't care about the order of the elements inside
                // the array, you should sort both arrays here.
                // Please note that calling sort on an array will modify that array.
                // you might want to clone your array first.

                for (var i = 0; i < a.length; ++i) {
                    if (a[i] !== b[i]) return false;
                }
                return true;
            }

            resetquestion = function () {
                for (let i = 0; i < qlib.length; i++) {
                    qarr[i] = i
                }
            }

            function makeTableHTML(myArray) {
                var result = "<table class=\"table1\" align=center>";
                for (var i = 0; i < myArray.length; i++) {
                    result += "<tr class=\"tr1\">";
                    for (var j = 0; j < myArray[i].length; j++) {
                        result += "<td class=\"td1\">" + myArray[i][j] + "</td>";
                    }
                    result += "</tr>";
                }
                result += "</table>";

                return result;
            }

            function max(bob) {
                var par = [];
                var mat = [];
                for (var i = 0; i < bob.length; i++) {
                    mat[i] = Number(bob[i])
                    if (!isNaN(mat[i])) {
                        par.push(mat[i]);
                    }
                }
                return Math.max.apply(Math, par);
            }

            function sum(bob) {
                var par = [];
                var mat = [];
                for (var i = 0; i < bob.length; i++) {
                    mat[i] = Number(bob[i])
                    if (!isNaN(mat[i])) {
                        par.push(mat[i]);
                    }
                }
                return math.sum(par);
            }

            function makeTableHTMLRep(myArray) {
                var result = "<table align=center>";
                result += "<tr>";
                for (var i = 0; i < myArray.length; i++) {
                    result += "<td>" + myArray[i] + "</td>";
                }
                result += "</tr>";
                result += "</table>";

                return result;
            }

            function shuffle(array) {
                var m = array.length, t, i;

                // While there remain elements to shuffle…
                while (m) {

                    // Pick a remaining element…
                    i = Math.floor(Math.random() * m--);

                    // And swap it with the current element.
                    t = array[m];
                    array[m] = array[i];
                    array[i] = t;
                }

                return array;
            }

            var qlib = [
                {
                    type: "pluralité",
                    variables: [["options", 'g'], ["varnum", '']],
                    varnom: [""],
                    varmax: [25, 200, 8],
                    varmin: [],
                    lenq: function (qtable) {
                        return (Math.floor(Math.random() * (qtable[0].length - 3)) + 3);
                    },
                    varnum: function (max) {
                        return (shuffle(Array.from(Array(max).keys())))
                    },
                    createTable: function (quest, tab) {
                        document.getElementById('table').innerHTML = makeTableHTML(tab);
                        quest.repSoum(tab);
                        quest.reponseInput(tab[0]);
                    },
                    reponseInput: function creerbouton(bouttons) {
                        var mat = [];
                        for (let z = 0; z < bouttons.length - 1; z++) {
                            mat[z] = `<input type="button" class="button4" value="${bouttons[z + 1]}" id='${bouttons[z + 1]}'' onclick="setTimeout(function(){soum('${bouttons[z + 1]}')},100)">`
                        }
                        document.getElementById('tableRep').innerHTML = makeTableHTMLRep(mat)
                    },
                    testSoum: function testSoum(tab, repEleve) {
                        return (repEleve == reponse)
                    },
                    repSoum: function repSoum(mat) {
                        reponse = mat[0][mat[1].indexOf(String(max(mat[1])))];
                        console.log(reponse)
                    },
                    texte: [`Un groupe d'élèves votent pour le représentant de classe à l'aide d'un vote à pluralité. Détermine le ou la gagnante.`,
                        `Les élèves de secondaire 5 votent pour la dernière chanson qui sera jouée au bal des finissants à l'aide d'un vote à pluralité. Détermine la chanson gagnante.`,
                        `Un groupe d'amis votent pour leur destination de road trip d'été à l'aide d'un vote à pluralité. Détermine la destination gagnante.`],
                    options: [["Brad", "Flavien", "Bob", "Charles", "Valence", "Petrolia"], ["Let it be", "I Feel like a Woman", "Happy", "Le phoque en Alaska", "La rue principale", "L'hymne à la joie"], ["Colombie-Brittanique", "Rawdon", "Floride", "Utah", "Drummondville", "Californie"]],
                    table: [["", "options", "options", "options", "options", "options", "options"], ["Nombre de votes", "varnum", "varnum", "varnum", "varnum", "varnum", "varnum"]]
                },
                {
                    type: "assentiment",
                    variables: [["options", 'g'], ["varnum", '']],
                    varnom: [""],
                    varmax: [25, 200, 8],
                    varmin: [],
                    lenq: function (qtable) {
                        return (Math.floor(Math.random() * (qtable[0].length - 3)) + 3);
                    },
                    varnum: function (max) {
                        return (shuffle(Array.from(Array(max).keys())))
                    },
                    createTable: function (quest, tab) {
                        document.getElementById('table').innerHTML = makeTableHTML(tab);
                        quest.repSoum(tab);
                        quest.reponseInput(tab[0]);
                    },
                    reponseInput: function creerbouton(bouttons) {
                        var mat = [];
                        for (let z = 0; z < bouttons.length - 1; z++) {
                            mat[z] = `<input type="button" class="button4" value="${bouttons[z + 1]}" id='${bouttons[z + 1]}'' onclick="setTimeout(function(){soum('${bouttons[z + 1]}')},100)">`
                        }
                        document.getElementById('tableRep').innerHTML = makeTableHTMLRep(mat)
                    },
                    testSoum: function testSoum(tab, repEleve) {
                        return (repEleve == reponse)
                    },
                    repSoum: function repSoum(mat) {
                        reponse = mat[0][mat[1].indexOf(String(max(mat[1])))];
                        console.log(reponse)
                    },
                    texte: [`Un groupe d'élèves votent pour le représentant de classe à l'aide d'un vote par assentiement. Détermine le ou la gagnante.`,
                        `Les élèves de secondaire 5 votent pour la dernière chanson qui sera jouée au bal des finissants à l'aide d'un vote par assentiement. Détermine la chanson gagnante.`,
                        `Un groupe d'amis votent pour leur destination de road trip d'été à l'aide d'un vote par assentiement. Détermine la destination gagnante.`],
                    options: [["Brad", "Flavien", "Bob", "Charles", "Valence", "Petrolia"], ["Let it be", "I Feel like a Woman", "Happy", "Le phoque en Alaska", "La rue principale", "L'hymne à la joie"], ["Colombie-Brittanique", "Rawdon", "Floride", "Utah", "Drummondville", "Californie"]],
                    table: [["", "options", "options", "options", "options", "options", "options"], ["Nombre de votes", "varnum", "varnum", "varnum", "varnum", "varnum", "varnum"]]
                },
                {
                    type: "majorité",
                    variables: [["options", 'g'], ["varnum", '']],
                    varnom: [""],
                    varmax: [25, 200, 8],
                    varmin: [],
                    lenq: function (qtable) {
                        return (Math.floor(Math.random() * (qtable[0].length - 3)) + 3);
                    },
                    varnum: function (max) {
                        return (shuffle(Array.from(Array(max).keys())))
                    },
                    createTable: function (quest, tab) {
                        document.getElementById('table').innerHTML = makeTableHTML(tab);
                        quest.repSoum(tab);
                        quest.reponseInput(tab[0]);
                    },
                    reponseInput: function creerbouton(bouttons) {
                        var mat = [];
                        bouttons.shift()
                        bouttons.unshift("Aucun gagnant")
                        console.log(bouttons)
                        for (let z = 0; z < bouttons.length; z++) {
                            mat[z] = `<input type="button" class="button4" value="${bouttons[z]}" id='${bouttons[z]}'' onclick="setTimeout(function(){soum('${bouttons[z]}')},100)">`
                        }
                        document.getElementById('tableRep').innerHTML = makeTableHTMLRep(mat)
                    },
                    testSoum: function testSoum(tab, repEleve) {
                        return (repEleve == reponse)
                    },
                    repSoum: function repSoum(mat) {
                        var valmax = max(mat[1])
                        var tot = sum(mat[1])
                        if (valmax / tot > 0.5) {
                            reponse = mat[0][mat[1].indexOf(String(max(mat[1])))];
                        } else {
                            reponse = "Aucun gagnant";
                        }
                    },
                    texte: [`Un groupe d'élèves votent pour le représentant de classe à l'aide d'un vote à majorité. Détermine le ou la gagnante.`,
                        `Les élèves de secondaire 5 votent pour la dernière chanson qui sera jouée au bal des finissants à l'aide d'un vote à majorité. Détermine la chanson gagnante.`,
                        `Un groupe d'amis votent pour leur destination de road trip d'été à l'aide d'un vote à majorité. Détermine la destination gagnante.`],
                    options: [["Brad", "Flavien", "Bob", "Charles", "Valence", "Petrolia"], ["Let it be", "I Feel like a Woman", "Happy", "Le phoque en Alaska", "La rue principale", "L'hymne à la joie"], ["Colombie-Brittanique", "Rawdon", "Floride", "Utah", "Drummondville", "Californie"]],
                    table: [["", "options", "options", "options", "options", "options", "options"], ["Nombre de votes", "varnum", "varnum", "varnum", "varnum", "varnum", "varnum"]]
                },
                {
                    type: "proportionnel",
                    variables: [["options", 'g'], ["varnum", '']],
                    varnom: [""],
                    varmax: [1000],
                    varmin: [100],
                    vardiv: ["Nombre de sièges"],
                    ndiv: null,
                    lenq: function (qtable) {
                        return (Math.floor(Math.random() * (qtable[0].length - 3)) + 3);
                    },
                    varnum: function (max, min) {
                        var arr = Array.from(Array(max).keys())
                        arr.splice(0, min)
                        return (shuffle(arr))
                    },
                    createTable: function (quest, tab, textrand) {
                        quest.ndiv = Math.floor(Math.random() * 101 + 7);
                        quest.texte[textrand] = quest.texte[textrand].replace("ndiv", quest.ndiv)
                        tab.push(quest.reponseInput(quest, tab[0], textrand));
                        document.getElementById('table').innerHTML = makeTableHTML(tab);
                        document.getElementById('tableRep').innerHTML = `<input type="button" class="button1" value="Soumettre" id="bouttonSoum" onclick="setTimeout(function(){soum('bouttonSoum')},100)">`
                        quest.repSoum(tab, quest);
                    },
                    reponseInput: function creerbouton(quest, tab, textrand) {
                        var mat = [];
                        for (let z = 0; z < tab.length - 1; z++) {
                            mat[z] = `<input type="text" class="inputbar1" id="${tab[z + 1]}" />`
                        }
                        mat.unshift(quest.vardiv[textrand])
                        return mat
                    },
                    testSoum: function testSoum(tab) {
                        var repEleve = [];
                        for (let z = 0; z < tab[0].length - 1; z++) {
                            repEleve[z] = Number(document.getElementById(tab[0][z + 1]).value);
                        }
                        return (arraysEqual(repEleve, reponse))
                    },
                    repSoum: function repSoum(mat, quest) {
                        var reponses = [];
                        var entiers = [];
                        var restes = [];
                        var valtot = sum(mat[1])
                        for (let z = 1; z < mat[1].length; z++) {
                            entiers[z] = Math.floor(mat[1][z] / valtot * quest.ndiv);
                            restes[z] = mat[1][z] / valtot * quest.ndiv - Math.floor(mat[1][z] / valtot * quest.ndiv)
                        }
                        entiers.shift()
                        restes.shift()

                        for (let z = 0; z <= Math.round(sum(restes)); z++) {
                            var maxresteInd = restes.findIndex(function (x) { return x == max(restes) })
                            entiers[maxresteInd] = entiers[maxresteInd] + 1
                            restes[maxresteInd] = restes[maxresteInd] - 1
                        }
                        console.log(entiers)
                        reponse = entiers;
                    },
                    texte: ["Voici les résultat de l'élection à la mairie de Saint-creux-les-profonds. Il y a ndiv postes à pourvoir. Détermine la distributions des sièges."],
                    options: [["Saint-creux solidaire", "Profond et fier", "Parti creumuniste", "Parti Giraffe", "Alliance creuse", "Creuse!"]],
                    table: [["", "options", "options", "options", "options", "options", "options"], ["Nombre de votes", "varnum", "varnum", "varnum", "varnum", "varnum", "varnum"]]
                },
                {
                    type: "condorcet",
                    variables: [["options", 'g'], ["varnum", '']],
                    varnom: [""],
                    varmax: [45],
                    varmin: [5],
                    vardiv: ["Nombre de sièges"],
                    lenq: function () { return (4) },
                    varnum: function (max, min) {
                        var arr = Array.from(Array(max).keys())
                        arr.splice(0, min)
                        return (shuffle(arr))
                    },
                    createTable: function (quest, tab, textrand) {
                        tab[0].sort(function (a, b) { return b - a });
                        document.getElementById('table').innerHTML = makeTableHTML(tab);
                        quest.reponseInput(quest.options[textrand]);
                        quest.repSoum(tab, quest);

                    },
                    reponseInput: function creerbouton(bouttons) {
                        var mat = [];
                        for (let z = 0; z < bouttons.length; z++) {
                            mat[z] = `<input type="button" class="button4" value="${bouttons[z]}" id='${bouttons[z]}'' onclick="setTimeout(function(){soum('${bouttons[z]}')},100)">`
                        }
                        document.getElementById('tableRep').innerHTML = makeTableHTMLRep(mat)
                    },
                    testSoum: function testSoum(tab) {
                        var repEleve = [];
                        for (let z = 0; z < tab[0].length - 1; z++) {
                            repEleve[z] = Number(document.getElementById(tab[0][z + 1]).value);
                        }
                        return (arraysEqual(repEleve, reponse))
                    },
                    repSoum: function repSoum(mat, quest) {
                        var matclean = []
                        for (i of mat) {
                            i.shift(
                                matclean.push(i))
                        }
                        for (i in quest.options) {
                            for()
                        }
                        console.log(matclean)
                    },
                    texte: ["Les élèves de secondaire 5 doivent choisir une activité récompense. Détermine le choix gagnant à l'aide de la méthode de condorcet."],
                    options: [["Bungee", "Ski alpin", "Paintball"]],
                    table: [["Nombre de votes", "varnum", "varnum", "varnum"], ["Premier choix", "Bungee", "Ski alpin", "Paintball"], ["Deuxième choix", "Ski alpin", "Bungee", "Bungee"], ["Troisième choix", "Paintball", "Paintball", "Ski alpin"]]
                }
            ]
            var qarr = [];

            resetquestion()

            var total = 4;
            var erreurs = 0;
            var reussi = 0;
            var nbEssais = 0;
            var qtexte = null;
            var diffq = 0;
            var qpretty = null;
            var rand;
            var reponse = null;
            var question = null;
            var table = [];


            document.getElementById('reussi').value = reussi
            document.getElementById('erreurs').value = erreurs
            document.getElementById('total').value = total

            button = document.getElementById('bouttonSoum')

            const expr1 = []
            const expr2 = []

            nouvelleQ()

            const result = []
            let parenthesis = 'keep'
            let implicit = 'hide'

        </script>

</body>

</html>
