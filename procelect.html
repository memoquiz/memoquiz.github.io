<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Problèmes textuels</title>

    <script src="https://unpkg.com/mathjs@6.5.0/dist/math.min.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML.js"></script>
    <script src="https://memoquiz.github.io/algebrite.bundle-for-browser.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">

</head>

<body>

    <h1>
        Résous le problème suivant
    </h1>
    <div>
        <h2 id="prob"></h2>
        <h2 id="table"></h2>
    </div>
    <h2>
        <table align="center">
            <tr>
                <td align="center" width=100px>
                    <input class=inputbar3 type="text" id="reponse"></td>
                <td align="left" width=5px>
                    <h2 id="unite"></h2>
                </td>
                </div>
            </tr>
        </table>
    </h2>
    <h2 id=tableRep></h2>
    <h3 id="expr1"></h3>
    <h2>
        <br>Progression : <output id="reussi"></output> / <output id="total"></output>
        <br>Erreurs : <output id="erreurs"></output>

        <script>

            function nouvelleQ() {

                rand = Math.floor(Math.random() * qarr.length);
                var question = qlib[qarr[rand]];
                var variabtext = question.variables;
                var textrand = Math.floor(Math.random() * question.texte.length);
                var qtexte = question.texte[textrand];
                var qtable = question.table;

                for (i of variabtext) {
                    var regex = RegExp(i[0], i[1]);
                    var remplarr = [];
                    console.log(i)
                    try {
                        var varlen = question[i[0]][textrand].length
                        var varib = question[i[0]][textrand]
                    } catch {
                        var varib = question[i[0]](question.varmax[textrand])
                        var varlen = varib.length
                    }

                    for (let y = 0; y < varlen; y++) {
                        remplarr[y] = y;
                    }

                    for (let z = 0; z < qtable.length; z++) {
                        for (let w = 0; w < qtable[z].length; w++) {
                            if (qtable[z][w].match(regex)) {
                                var rand2 = Math.floor(Math.random() * remplarr.length);
                                var rempl = varib[remplarr[rand2]];
                                remplarr.splice(rand2, 1);
                                qtable[z][w] = qtable[z][w].replace(regex, rempl);
                            }
                        }
                    }
                }

                document.getElementById('prob').innerHTML = qtexte;
                document.getElementById('table').innerHTML = makeTableHTML(question.table)
                question.reponseInput(question.options[textrand])

                update()
            }

            soum = function () {
                var repEleve = document.getElementById('reponse').value.toString()
                repEleve = repEleve.replace(/,/g, ".")
                repEleve = repEleve.replace(/\$/g, "")
                if (repEleve != "") {
                    document.getElementById('reponse').value = null

                    var succes = (repEleve - reponse) / reponse < 0.1;

                    if (succes == true) {
                        if (nbEssais == 0) {
                            reussi++
                            qarr.splice(rand, 1)
                        }
                        nbEssais = 0
                        if (reussi < total) {
                            nouvelleQ()
                            button.style.backgroundColor = "#4CAF50"
                            button.value = "Soumettre"

                        } else {
                            if (reussi / total > 0.8) {
                                document.getElementById('expr1').innerHTML = 'Bravo!'
                            } else {
                                document.getElementById('expr1').innerHTML = 'Tu as besoin de plus de pratique on dirait'
                            }
                            button.style.backgroundColor = "#4CAF50"
                            button.value = "Recommencer ?"
                            button.onclick = recommencer
                            update()
                            diff(val)
                        }
                    } else {
                        nbEssais = 1
                        button.style.backgroundColor = "red"
                        button.value = "Réessaie !"
                        erreurs++
                        update()

                    }
                }
            }

            recommencer = function () {
                reussi = 0
                erreurs = 0
                resetquestion()
                nouvelleQ()
                button.value = "Soumettre"
                button.onclick = soum

            }

            update = function () {
                document.getElementById('reussi').value = reussi
                document.getElementById('erreurs').value = erreurs
                document.getElementById('total').value = total
            }

            var qlib = [
                {
                    variables: [["options", 'g'], ["varnum", '']],
                    varnom: [""],
                    varmax: [25, 200, 8],
                    varnum: function (max) {
                        return ([...Array(10)].map(() => Math.floor(Math.random() * max)))
                    },
                    reponseInput: function creerbouton(bouttons) {
                        var mat = [];
                        for (let z = 0; z < bouttons.length; z++) {
                            mat[z] = `<input type="button" class="button4" value="${bouttons[z]}" id="bouttonSoum" onclick="setTimeout(function(){soum(${bouttons[z]})},100)">`
                        }
                        document.getElementById('tableRep').innerHTML = makeTableHTMLRep(mat)
                    },
                    texte: [`Un groupe d'élèves votent pour le représentant de classe à l'aide d'un vote à majorité. Détermine l'option gagnante.`,
                        `Les élèves de secondaire 5 votent pour la dernière chanson qui sera jouée au bal des finissants à l'aide d'un vote à majorité. Détermine l'option gagnante.`,
                        `Un groupe d'amis votent pour leur destination de road trip d'été à l'aide d'un vote à majorité. Détermine l'option gagnante.`],
                    options: [["Brad", "Flavien", "Bob", "Charles", "Valence", "Petrolia"], ["Let it be", "I Feel like a Woman", "Happy", "Le phoque en Alaska", "La rue principale", "L'hymne à la joie"], ["Colombie-Brittanique", "Rawdon", "Floride", "Utah", "Drummondville", "Californie"]],
                    table: [["", "options", "options", "options", "options", "options", "options"], ["Nombre de votes", "varnum", "varnum", "varnum", "varnum", "varnum", "varnum"]]
                }
            ]
            var qarr = [];

            function resetquestion() {
                for (let i = 0; i < qlib.length; i++) {
                    qarr[i] = i
                }
            }
            function makeTableHTML(myArray) {
                var result = "<table class=\"table1\" align=center>";
                for (var i = 0; i < myArray.length; i++) {
                    result += "<tr class=\"tr1\">";
                    for (var j = 0; j < myArray[i].length; j++) {
                        result += "<td class=\"td1\">" + myArray[i][j] + "</td>";
                    }
                    result += "</tr>";
                }
                result += "</table>";

                return result;
            }

            function makeTableHTMLRep(myArray) {
                var result = "<table align=center>";
                result += "<tr>";
                for (var i = 0; i < myArray.length; i++) {
                    result += "<td>" + myArray[i] + "</td>";
                }
                result += "</tr>";
                result += "</table>";

                return result;
            }

            resetquestion()

            var total = 5;
            var erreurs = 0;
            var reussi = 0;
            var nbEssais = 0;
            var qtexte = null;
            var diffq = 0;
            var qpretty = null;
            var rand;

            document.getElementById('reussi').value = reussi
            document.getElementById('erreurs').value = erreurs
            document.getElementById('total').value = total

            button = document.getElementById('bouttonSoum')

            const expr1 = []
            const expr2 = []

            var reponse = null
            nouvelleQ()

            const result = []
            let parenthesis = 'keep'
            let implicit = 'hide'

        </script>

</body>

</html>
