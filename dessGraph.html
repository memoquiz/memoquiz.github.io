<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Procédures électorales</title>

    <script src="https://unpkg.com/mathjs@6.5.0/dist/math.min.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML.js"></script>
    <script src="https://memoquiz.github.io/algebrite.bundle-for-browser.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.min.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">

</head>

<body>

    <h1>
        Résous le problème suivant
    </h1>
    <div>
        <h2 id="prob"></h2>
        <h2 id="table"></h2>
    </div>
    <h2 id="tableRep"></h2>
    <h3 id="expr1"></h3>

    <DIV id="chart1" class="chart-container" style="position: center; height:340px; width:700px;">
        <CANVAS id="graph_1" style="background-color: #CBCBCB;"></CANVAS>
    </DIV>
    <h2>
        <input type="button" class="button6" value="Soumettre" id='Soumettre' onclick="soum()">
        <br>
        <input type="button" class="button6" value="Sauter la question" id='Sauter' onclick="nouvelleQ()">

        <br>Progression : <output id="reussi"></output> / <output id="total"></output>
        <br>Erreurs : <output id="erreurs"></output>
    </h2>
    <script>
        $(document).ready(function () {
            var ctx = $("#graph_1");
            var dataArray = [];
            var dataArray2 = [];
            var a = 0;
            var b = 0;


            var myChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        lineTension: 0,
                        backgroundColor: "black",
                        showline: false,
                        fill: false,
                        data: dataArray
                    }, {
                        lineTension: 0,
                        borderColor: "grey",
                        backgroundColor: "grey",
                        fill: false,
                        data: dataArray2
                    }]
                },
                options: {
                    title: {
                        display: true,
                    },
                    legend: {
                        display: false
                    },
                    animation: {
                        duration: 0,
                    }, // general animation time
                    hover: {
                        animationDuration: 0,
                    }, // duration of animations when hovering an item
                    responsiveAnimationDuration: 0, // animation duration after a resize
                    scales: {
                        xAxes: [{
                            display: true,
                            ticks: {
                                min: -10,
                                max: 10,
                                stepSize: 1
                            },
                            scaleLabel: {
                                display: true,
                                labelString: 'x'
                            }
                        }],
                        yAxes: [{
                            elements: {
                                line: {
                                    tension: 0
                                }
                            },
                            display: true,
                            ticks: {
                                min: -10,
                                max: 10,
                                stepSize: 1
                            },
                            scaleLabel: {
                                display: true,
                                labelString: 'y'
                            }
                        }]
                    },
                    tooltips: false,
                }

            });

            ctx.click(function (evt) {
                var ytop = myChart.chartArea.top;
                var ybottom = myChart.chartArea.bottom;
                var ymin = myChart.scales['y-axis-1'].min;
                var ymax = myChart.scales['y-axis-1'].max;
                var newy = '';
                var showstuff = 0;
                if (evt.offsetY <= ybottom && evt.offsetY >= ytop) {
                    newy = Math.abs((evt.offsetY - ytop) / (ybottom - ytop));
                    newy = (newy - 1) * -1;
                    newy = newy * (Math.abs(ymax - ymin)) + ymin;
                    showstuff = 1;
                }
                var xtop = myChart.chartArea.left;
                var xbottom = myChart.chartArea.right;
                var xmin = myChart.scales['x-axis-1'].min;
                var xmax = myChart.scales['x-axis-1'].max;
                var newx = '';
                if (evt.offsetX <= xbottom && evt.offsetX >= xtop && showstuff == 1) {
                    newx = Math.abs((evt.offsetX - xtop) / (xbottom - xtop));
                    newx = newx * (Math.abs(xmax - xmin)) + xmin;
                    if (dataArray.length < 2) {
                        dataArray.push({ x: newx, y: newy })
                    }
                    console.log(dataArray.length)
                    if (dataArray.length == 2 & dataArray2.length == 0) {
                        console.log(dataArray)
                        a = (dataArray[0].y - dataArray[1].y) / (dataArray[0].x - dataArray[1].x)
                        b = dataArray[1].y - (dataArray[1].x * a)
                        console.log(a, b)
                        dataArray2.push({ x: -11, y: (a * -11) + b }, { x: 11, y: (a * 11) + b })
                    }
                    console.log(dataArray2)
                    myChart.update()
                }
            });
        });

        nouvelleQ = function () {
            qlib.createQuestion(qlib)
            // update()
        }

        soum = function (repEleve) {
            var succes = question.testSoum(table, repEleve);
            if (succes == true) {
                if (nbEssais == 0) {
                    reussi++
                }
                nbEssais = 0
                if (reussi < total) {
                    nouvelleQ()
                    button.style.backgroundColor = "#4CAF50"
                    button.value = "Soumettre"

                } else {
                    if (reussi / total > 0.8) {
                        document.getElementById('table').innerHTML = '';
                        document.getElementById('prob').innerHTML = 'Bravo!'
                    } else {
                        document.getElementById('prob').innerHTML = 'Tu as besoin de plus de pratique on dirait'
                    }
                    document.getElementById('tableRep').innerHTML = '<input type="button" class="button3" value="Recommancer?" id="Recommencer" style.backgroundColor = "#4CAF50" onclick="setTimeout(function(){recommencer()},100)">'
                    update()
                }
            } else {
                nbEssais = 1
                button.style.backgroundColor = "red"
                erreurs++
                update()

            }

        }

        recommencer = function () {
            location.reload();
            return false;
        }

        update = function () {
            document.getElementById('reussi').value = reussi
            document.getElementById('erreurs').value = erreurs
            document.getElementById('total').value = total
        }

        function shuffle(array) {
            var m = array.length, t, i;

            // While there remain elements to shuffle…
            while (m) {

                // Pick a remaining element…
                i = Math.floor(Math.random() * m--);

                // And swap it with the current element.
                t = array[m];
                array[m] = array[i];
                array[i] = t;
            }

            return array;
        }


        var qlib = {
            varmax: [10],
            varmin: [1],
            varnum: function (max, min) {
                return (shuffle(Array.from(Array(max).keys()) + min))
            },
            createQuestion: function (quest) {
                var texte = quest.texte();
                var varnums = quest.varnum(quest.varmax, quest.varmin)
                texte = texte.replace(/varpente/g, varnums[0])
                texte = texte.replace(/ordor/g, varnums[1])
                document.getElementById('prob').innerHTML = texte
            },
            reponseInput: function creerbouton(bouttons) {
                var mat = [];
                for (let z = 0; z < bouttons.length - 1; z++) {
                    mat[z] = `<input type="button" class="button4" value="${bouttons[z + 1]}" id='${bouttons[z + 1]}'' onclick="setTimeout(function(){soum('${bouttons[z + 1]}')},100)">`
                }
                document.getElementById('tableRep').innerHTML = makeTableHTMLRep(mat)
            },
            testSoum: function testSoum(tab, repEleve) {
                return (repEleve == reponse)
            },
            repSoum: function repSoum(mat) {
                reponse = mat[0][mat[1].indexOf(String(max(mat[1])))];
                console.log(reponse)
            },
            texte: function (quest, textrand) {
                return ("Trace la droite suivante sur le plan cartésien suivant en plaçant 2 points.<br>y=varpentex+ordor")
            },
        }

        var qarr = [];
        var qliste = [];
        var total = 30;
        var erreurs = 0;
        var reussi = 0;
        var nbEssais = 0;
        var qtexte = null;
        var rand;
        var reponse = null;
        var table = [];
        var mat = [];

        for (let i = 0; i < qlib.length; i++) {
            qliste[i] = i;
        }

        for (let z = 0; z < qlib.length; z++) {
            mat[z] = `<input type="button" class="button5" value="${qlib[z].type}" id='${qlib[z].type}' onclick = "enlever(${z})">`
        }

        document.getElementById('reussi').value = reussi
        document.getElementById('erreurs').value = erreurs
        document.getElementById('total').value = total
        button = document.getElementById('bouttonSoum')

        nouvelleQ()

    </script>

</body>
